<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
		<title>FluxNode Administration Console</title>
		<link type="text/css" href="/vendors/jquery-ui/css/ui-lightness/jquery-ui-1.8.22.custom.css" rel="stylesheet" />
		<style>
			body { font-size: 62.5%; }
			label, input { display:block; }
			input.text { margin-bottom:12px; width:95%; padding: .4em; }
			fieldset { padding:0; border:0; margin-top:25px; }
			h1 { font-size: 1.2em; margin: .6em 0; }
			div#users-contain { width: 350px; margin: 20px 0; }
			div#users-contain table { margin: 1em 0; border-collapse: collapse; width: 100%; }
			div#users-contain table td, div#users-contain table th { border: 1px solid #eee; padding: .6em 10px; text-align: left; }
			.ui-dialog .ui-state-error { padding: .3em; }
			.validateTips { border: 1px solid transparent; padding: 0.3em; }
			
			ul.toolbar li {
			    cursor: pointer;
			    float: left;
			    list-style: none outside none;
			    margin: 2px;
			    padding: 4px 0;
			    position: relative;
			}
		</style>
		<script src="/vendors/jquery-ui/js/jquery-1.7.2.min.js"></script>
		<script src="/vendors/jquery-ui/js/jquery-ui-1.8.22.custom.min.js"></script>
		
		<script src="/socket.io/socket.io.js"></script>
		
	</head>
	<body>
		
		<div id="login-form" title="Console Login">
			<form>
			<fieldset>
				<label for="UserName">User Name</label>
				<input type="text" name="UserName" id="UserName" class="text ui-widget-content ui-corner-all" />
				<label for="password">Password</label>
				<input type="password" name="UserPass" id="UserPass" value="" class="text ui-widget-content ui-corner-all" />
			</fieldset>
			</form>
		</div>
		<div id="console-tabs-window">
			<div id="console-tabs">
				<ul>
					<li><a href="#console-tabs-1">Data</a></li>
					<li><a href="#console-tabs-2">Mixins</a></li>
					<li><a href="#console-tabs-3">Transports</a></li>
				</ul>
				<div id="console-tabs-1">
					<p>
						
					</p>
				</div>
				<div id="console-tabs-2">
					<p id="mixin-toolbar" class="fg-toolbar">
						<ul  class="toolbar ui-widget ui-helper-clearfix">
							<li class="ui-state-default ui-corner-all"><span class="ui-icon ui-icon-circle-plus">Add</span></li>
						</ul>
					</p>
					<p id="mixin-content"></p>
				</div>
				<div id="console-tabs-3">
					<p id="transport-content"></p>
				</div>
			</div>
		</div>
		<script>
		  var socket = io.connect('http://localhost');
		  socket.on('Ready', function (data) {
		    socket.emit('my other event', { my: 'data' });
		  });
		  
		  $(function() {
		  	var userName = $( "#UserName" ),
			userPass = $( "#UserPass" ),
			allFields = $( [] ).add( userName ).add( userPass );
		  	$( "#console-tabs-window" ).dialog({
		  		autoOpen: false,
			});
			socket.on('message', function(data){
				var message = JSON.parse(data);
				console.log(message);
			});
		  	//$( "#console-tabs-window" ).dialog('close');
		  	socket.once('LoginSuccessful', function(data){
		  		console.log('asdlfjkldskajfla');
						socket.removeAllListeners('LoginFailed');
						$('#login-form').dialog("close");
						$( "#console-tabs").tabs();
						$('#console-tabs-window').dialog('open');
						//$('#console-tabs').show('slide');
						socket.on('update_data', function(data){
							var newData = '<table id="data_table" width="100%">';
							newData+='<thead><tr class="ui-widget-header "><th>Name</th><th>Settings</th></tr></thead><tbody>';
							for(var x in data.Data){
								newData+='<tr><th valign="top">'+x+'</th><td>'+data.Data[x]+'</td></tr>';
							}
							newData+='</tbody</table>';
							$('#console-tabs-1').html('<p>'+newData+'</p>');
							
							var mixinData = '<table id="mixin_table" width="100%">';
							mixinData+='<thead><tr class="ui-widget-header "><th>Name</th><th>Settings</th></tr></thead><tbody>';
							for(var x in data.Mixins){
								var mixin = data.Mixins[x];
								mixinData+='<tr><th valign="top">'+x+'</th><td>';
								mixinData+='<table width="100%">';
								for(var y in mixin){
									mixinData += '<tr><td><b>'+y+'</b></td><td>'+mixin[y]+'</td></tr>';
								}
								mixinData+='</table>';
								mixinData+='</td></tr>';
							}
							mixinData+='</tbody></table>';
							$('#mixin-content').html('<p>'+mixinData+'</p>');
							
							var transportData = '<table id="transport_table" width="100%">';
							transportData+='<thead><tr class="ui-widget-header "><th>Name</th><th>Settings</th></tr></thead><tbody id="transport_table_data">';
							for(var x in data.Transports){
								var transport = data.Transports[x];
								transportData+='<tr><th valign="top">'+x+'</th><td>';
								transportData+='<table width="100%">';
								for(var y in transport){
									transportData += '<tr><td><b>'+y+'</b></td><td>'+transport[y]+'</td></tr>';
								}
								transportData+='</table>';
								transportData+='</td></tr>';
							}
							transportData+='</tbody></table>';
							$('#transport-content').html('<p>'+transportData+'</p>');
						});
						
						socket.on('node_event', function(data){
							switch(data.topic){
								case 'fluxnode.transport.ready':
									var transportData = '<tr><td><b>'+data.payload.FluxNodeID+'</b></td><td>'+data.payload.FluxNodeName+'</td></tr>';
									$('#transport_table_data').append(transportData);
									break;
							}
							console.log(data.topic);
							console.log(data.payload);
						});
					});
					
					socket.once('LoginFailed', function(data){
						socket.removeAllListeners('LoginSuccessful');
						userName.val('');
						userPass.val('');
						$('#login-form').effect("pulsate");
					});
		  	$( "#login-form" ).dialog({
				autoOpen: true,
				height: 220,
				width: 350,
				buttons: {
				"Login": function() {
					socket.emit('login', {
						UserName: userName.val(),
						UserPass: userPass.val()
					})
				}
			},
			close: function() {
				allFields.val( "" ).removeClass( "ui-state-error" );
			}
			});
		  });
		</script>
	</body>
</html>
